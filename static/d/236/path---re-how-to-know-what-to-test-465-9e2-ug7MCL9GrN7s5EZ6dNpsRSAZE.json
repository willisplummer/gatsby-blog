{"data":{"site":{"siteMetadata":{"title":"Willis Plummer Dev Blog","author":"Willis Plummer"}},"markdownRemark":{"id":"ce2a5cc2-aeda-51dd-838f-caf017958b16","html":"<p>I sometimes find myself a little skeptical of Kent C Dodds’ approach to testing React applications, but it can be hard for me to pin down why. I think it relies a little too heavily on integration testing though I do agree with his guiding principal that we should avoid testing implementation details. I think I just disagree about what constitutes an implementation detail at times.</p>\n<p>But I’ve been thinking a lot recently about the purpose that tests serve. I think that we sometimes overlook or take for granted what exactly they’re doing for us.</p>\n<p>So I appreciate this article that he just posted, <a href=\"https://kentcdodds.com/blog/how-to-know-what-to-test\">How to know what to test</a>. It talks a little about the difference between code coverage and use-case coverage and provides an example of the dangers of missing a use-case in your tests:</p>\n<p>given the following function:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">function</span> <span class=\"token function\">arrayify</span><span class=\"token punctuation\">(</span>maybeArray<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>maybeArray<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> maybeArray\n  <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>maybeArray<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>Boolean<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>“So, as an example for how missing this test can go wrong, someone could come around, see that .filter(Boolean) thing and think: “Huh, that’s weird… I wonder if we really need that.” So they remove it, and our tests continue to pass, but any code that relied on the falsy behavior is now broken.”</p>\n</blockquote>\n<blockquote>\n<p>“Key takeaway: Test use cases, not code.”</p>\n</blockquote>\n<p>I’ve been watching a ton of Gary Bernhardt’s videos on <a href=\"https://www.destroyallsoftware.com/\">Destroy All Software</a> recently, and seeing how he approaches TDD (Test Driven Development) can provide a good contextual framework for how to ensure that you’re testing all the usecases.</p>\n<p>If he were implementing the <code class=\"language-text\">arrayify</code> function, he’d write a test that said, <code class=\"language-text\">when given an array it returns the array</code> and then implement that piece of code:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">arrayify</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>maybeArray<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> maybeArray</code></pre></div>\n<p>Then he’d write a test that said <code class=\"language-text\">when input is not an array it returns an array of the input</code> and implement the function to meet both use-cases:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">arrayify</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>maybeArray<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>maybeArray<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> maybeArray <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>maybeArray<span class=\"token punctuation\">]</span></code></pre></div>\n<p>At that point if he cared about enforcing that if the function was provided a falsey value, it would return an empty array, he’d write a third test <code class=\"language-text\">when given a falsey value it returns an empty array</code> and implement the function like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">arrayify</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>maybeArray<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Array<span class=\"token punctuation\">.</span><span class=\"token function\">isArray</span><span class=\"token punctuation\">(</span>maybeArray<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> maybeArray <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>maybeArray<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>Boolean<span class=\"token punctuation\">)</span></code></pre></div>\n<p>I don’t always practice TDD but I think this example reinforces the way that it makes identifying all of the use cases that need to be tested simpler, and it’s something that I’m trying to get into the habit of doing more of.</p>","timeToRead":2,"frontmatter":{"title":"Re: How To Know What To Test by Kent C Dodds","date":"April 16, 2018","langs":["en"],"spoiler":"TDD solves a lot of this"},"fields":{"slug":"/re-how-to-know-what-to-test/","langKey":"en"}}},"pageContext":{"slug":"/re-how-to-know-what-to-test/","previous":{"fields":{"slug":"/testing-anonymous-functions/","langKey":"en"},"frontmatter":{"title":"Testing Anonymous Functions"}},"next":null}}